
ICEMAN3D.Photo=function(){this.scene=null;this.camera=null;this.renderer=null;this.ambientLight=null;this.directionalLight=null;this.canvas=null;this.cameraMove=null;this.navigation=null;this.settings=null;this.drawLoop=null;this.enableDraw=null;this.modelHuidu=170;this.modelHeight=3;this.modelSize=35;this.modelMohu=4;this.isFromRight=true;this.bmgrayNO=false;this.plane=this.controls=null;this.mainMesh=null;this.bottomMesh=null;this.planeSize=100};ICEMAN3D.Photo.prototype.InitSettings=function(a){this.settings={cameraEyePosition:new ICEMAN3D.Coord(1,1,1),cameraCenterPosition:new ICEMAN3D.Coord(0,0,0),cameraUpVector:new ICEMAN3D.Coord(0,0,1),lightAmbientColor:[0.5,0.5,0.5],lightDiffuseColor:[0.5,0.5,0.5]};if(a!==undefined){if(a.cameraEyePosition!==undefined){this.settings.cameraEyePosition=ICEMAN3D.CoordFromArray(a.cameraEyePosition)}if(a.cameraCenterPosition!==undefined){this.settings.cameraCenterPosition=ICEMAN3D.CoordFromArray(a.cameraCenterPosition)}if(a.cameraUpVector!==undefined){this.settings.cameraUpVector=ICEMAN3D.CoordFromArray(a.cameraUpVector)}if(a.lightAmbientColor!==undefined){this.settings.lightAmbientColor=a.lightAmbientColor}if(a.lightDiffuseColor!==undefined){this.settings.lightDiffuseColor=a.lightDiffuseColor}}return true};ICEMAN3D.Photo.prototype.Start=function(b,e){if(!ICEMAN3D.IsWebGLEnabled()){return false}if(!this.InitSettings(e)){return false}if(!this.InitThree(b)){return false}if(!this.InitCamera(e)){return false}if(!this.InitLights()){return false}this.size=this.planeSize/2;var f=5;var g=new THREE.Geometry();for(var c=-this.size;c<=this.size;c+=f){g.vertices.push(new THREE.Vector3(-this.size,c,0));g.vertices.push(new THREE.Vector3(this.size,c,0));g.vertices.push(new THREE.Vector3(c,-this.size,0));g.vertices.push(new THREE.Vector3(c,this.size,0))}var d=new THREE.LineBasicMaterial({color:0,opacity:0.2,transparent:true});var a=new THREE.Line(g,d,THREE.LinePieces);var g=new THREE.PlaneBufferGeometry(this.planeSize,this.planeSize);this.plane=new THREE.Mesh(g);this.plane.visible=false;this.scene.add(this.plane);this.drawLoop=false;this.enableDraw=true;this.DrawIfNeeded();return true};ICEMAN3D.Photo.prototype.InitThree=function(a){this.canvas=a;if(!this.canvas||!this.canvas.getContext){return false}this.scene=new THREE.Scene();if(!this.scene){return false}var b={canvas:this.canvas,antialias:true,preserveDrawingBuffer:true};this.renderer=new THREE.WebGLRenderer(b);this.renderer.setPixelRatio(window.devicePixelRatio);if(!this.renderer){return false}this.renderer.setClearColor(new THREE.Color(16777215));this.renderer.setSize(this.canvas.width,this.canvas.height);return true};ICEMAN3D.Photo.prototype.InitCamera=function(a){this.cameraMove=new ICEMAN3D.Camera(ICEMAN3D.CoordFromArray(a.cameraEyePosition),ICEMAN3D.CoordFromArray(a.cameraCenterPosition),ICEMAN3D.CoordFromArray(a.cameraUpVector),a.fieldOfView,a.nearClippingPlane,a.farClippingPlane);if(!this.cameraMove){return false}this.navigation=new ICEMAN3D.Navigation();if(!this.navigation.Init(this.canvas,this.cameraMove,this.DrawIfNeeded.bind(this),this.Resize.bind(this))){return false}this.camera=new THREE.PerspectiveCamera(this.cameraMove.fieldOfView,this.canvas.width/this.canvas.height,this.cameraMove.nearClippingPlane,this.cameraMove.farClippingPlane);if(!this.camera){return false}this.scene.add(this.camera);return true};ICEMAN3D.Photo.prototype.InitLights=function(){var b=new THREE.Color();var c=new THREE.Color();b.setRGB(this.settings.lightAmbientColor[0],this.settings.lightAmbientColor[1],this.settings.lightAmbientColor[2]);c.setRGB(this.settings.lightDiffuseColor[0],this.settings.lightDiffuseColor[1],this.settings.lightDiffuseColor[2]);this.ambientLight=new THREE.AmbientLight(b.getHex());if(!this.ambientLight){return false}this.scene.add(this.ambientLight);this.directionalLight=new THREE.DirectionalLight(c.getHex());if(!this.directionalLight){return false}var a=new THREE.Vector3().subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,a.y,a.z);this.scene.add(this.directionalLight);return true};ICEMAN3D.Photo.prototype.Resize=function(){this.camera.aspect=this.canvas.width/this.canvas.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.canvas.width,this.canvas.height);this.DrawIfNeeded()};ICEMAN3D.Photo.prototype.EnableDraw=function(a){this.enableDraw=a};ICEMAN3D.Photo.prototype.Draw=function(){if(!this.enableDraw){return}this.camera.position.set(this.cameraMove.eye.x,this.cameraMove.eye.y,this.cameraMove.eye.z);this.camera.up.set(this.cameraMove.up.x,this.cameraMove.up.y,this.cameraMove.up.z);this.camera.lookAt(new THREE.Vector3(this.cameraMove.center.x,this.cameraMove.center.y,this.cameraMove.center.z));var a=new THREE.Vector3().subVectors(this.cameraMove.eye,this.cameraMove.center);this.directionalLight.position.set(a.x,a.y,a.z);this.renderer.render(this.scene,this.camera);if(this.drawLoop){setStyle(this.Draw.bind(this))}};ICEMAN3D.Photo.prototype.DrawIfNeeded=function(){if(!this.drawLoop){this.Draw()}};ICEMAN3D.Photo.prototype.VertexCount=function(){var a=0;this.scene.traverse(function(b){if(b instanceof THREE.Mesh&&b.name=="meshPhoto"){if(b.geometry instanceof THREE.Geometry){a=a+b.geometry.vertices.length}}});return a};